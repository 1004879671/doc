## mysql创建用户sql

> GRANT priv_type ON database.table TO user [IDENTIFIED BY [PASSWORD] 'password']
> 
> 其中：
> 
> - priv_type 参数表示新用户的权限；
> - database.table 参数表示新用户的权限范围，即只能在指定的数据库和表上使用自己的权限；
> - user 参数指定新用户的账号，由用户名和主机名构成；
> - IDENTIFIED BY 关键字用来设置密码；
> - password 参数表示新用户的密码。
> 
> create database nacos_config;
> 
> create user cty indentified by 'cty';
> 
> grant all on nacos_config.* to cty;

## 本地虚拟机mariadb：

> 192.168.175.120:3306@cty/cty    root用户：root/root

## 关闭和启动防火墙命令

> systemctl stop firewalld.service
> 
> systemctl status firewalld.service
> 
> systemctl restart firewalld.service

## 虚拟机静态IP配置文件

> cd /etc/sysconfig/network-scripts/
> 
> vi ifcfg-ens33 

## jdk环境变量

```
export JAVA_HOME=/usr/jdk1.8.0_331
export CLASSPATH=.:${JAVA_HOME}/jre/lib/rt.jar:${JAVA_HOME}/lib/dt.jar:${JAVA_HOME}/lib/tools.jar
export PATH=$PATH:${JAVA_HOME}/bin
```

## Kafka 的安装与运行

下载地址，对于各种操作系统来说，Kafka 的下载地址就只有一个 [Apache Kafka](https://kafka.apache.org/quickstart)  
Kafka 的相关命令

```bash
# Kafka 依赖于 ZK，先启动 ZK
zookeeper：sh bin/zookeeper-server-start.sh  ../config/zookeeper.properties
# 启动 Kafka 服务器
kafka-server：sh bin/kafka-server-start.sh ../config/server.properties
# 创建 Topic
create topic: bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test
# 查看 Topic 列表
topic list: bin/kafka-topics.sh --list --zookeeper localhost:2181
# 启动 Producer
producer: bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test
# 启动 Consumer
consumer: bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning
# 查看单个 Topic 信息
topic info: bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic test
```

### Zipkin 安装与配置

- 下载: https://zipkin.io/pages/quickstart.html
  
  - 选择自己需要的版本，我的是 zipkin-server-2.21.7-exec.jar

- 玩转 Zipkin

```bash
# 简单的看看, 默认端口号是 9411
java -jar zipkin-server-2.19.3-exec.jar
nohup java -jar zipkin-server-2.19.3-exec.jar &

# 访问地址
http://127.0.0.1:9411/

# 修改端口, 因为这就是一个 SpringBoot 应用
java -jar zipkin-server-2.19.3-exec.jar --server.port=8888

# 跟踪数据保存到 MySQL 中
wget https://github.com/openzipkin/zipkin/blob/master/zipkin-storage/mysql-v1/src/main/resources/mysql.sql

# zipkin 服务端可以从消息中间件 (RabbitMQ, Kafka) 获取跟踪数据, 只需要指定好地址就可以, 默认是 HTTP 接口, 性能较差
# 默认情况下，Zipkin Server 都会将跟踪信息存储在内存中，每次重启 Zipkin Server 都会使得之前收集的跟踪信息丢失，而且当有大量跟踪信息时我们的内存存储也会成为瓶颈
# 所有正常情况下我们都需要将跟踪信息对接到外部存储组件（比如 MySQL、Elasticsearch）中去
java -jar zipkin-server-2.23.18-exec.jar --STORAGE_TYPE=mysql --MYSQL_HOST=192.168.175.120 --MYSQL_TCP_PORT=3306 --MYSQL_USER=cty--MYSQL_PASS=cty--MYSQL_DB=e_commerce
java -DKAFKA_BOOTSTRAP_SERVERS=192.168.175.120:9092 -jar zipkin-server-2.23.18-exec.jar --STORAGE_TYPE=mysql --MYSQL_HOST=192.168.175.120 --MYSQL_TCP_PORT=3306 --MYSQL_USER=cty --MYSQL_PASS=cty --MYSQL_DB=e_commerce
```

```bash
java -DKAFKA_BOOTSTRAP_SERVERS=192.168.175.120:9092 -jar zipkin-server-2.23.18-exec.jar --STORAGE_TYPE=mysql --MYSQL_HOST=192.168.175.120 --MYSQL_TCP_PORT=3306 --MYSQL_USER=cty --MYSQL_PASS=cty --MYSQL_DB=e_commerce
```

### Hystrix总结

#### 1 对于微服务容错，你会考虑到哪些场景呢？也就是说，什么情况下才需要去做微服务容错？

- 接口的请求非常频繁，如果不频繁，让接口报错及时排查会更好…
- 接口涉及微服务调用，即存在依赖，则无法保证依赖方是否可用…

#### 2 Hystrix 里面有哪些功能实现模式？你能分析这些模式是怎么实现的吗？

- 断路器模式，会统计出错的百分比，达到阈值会打开断路器…
- 舱壁模式，使用信号量或者是线程池隔离资源…

#### 3 你会考虑怎么应用 Hystrix 呢？谈一谈这样做的理由？

- 在使用 OpenFeign 的时候一定要结合 Hystrix，因为存在微服务调用…

- 对于访问频繁的接口，使用线程池去隔离资源的使用…
