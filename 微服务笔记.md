## SpringCloud Stream 消息驱动组件与消息中间件Kafka

- 通过Binder组件实现与外部消息系统的通信，屏蔽了底层中间件的使用细节；

- 消息分组：应用多实例部署时，通过引入消息分组，避免消息被重复消费。如果不指定消息分组，spring默认为实例分配匿名分组，这样如果有个实例同个消息会被多次消费；

- 消息分区：为了确保具有共同特征的数据被同一个消费者实例进行处理；例如监控平台

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-16-17-01-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-16-21-43-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-16-26-38-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-16-26-58-image.png)

## SpringCloud Netflix Hystrix 容错组件

-  除了最基本的熔断、容错与服务降级外，还有请求缓存、请求合并，以及与openFeign集成实现openFeign的容错降级

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-16-56-31-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-17-16-11-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-17-17-11-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-17-18-09-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-17-19-01-image.png)

#### Hystrix提供请求缓存和请求合并应对高并发

- 请求缓存：在一次controller请求中，多次调用同一个微服务的情况下，根据catch key将请求结果缓存下来
  
  ![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-17-28-37-image.png)
  
  - 请求合并：将短时间内的多个请求合并为一个请求
    
    ![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-17-32-16-image.png)
    
    ![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-17-33-02-image.png)
    
    ![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-17-36-21-image.png)
    
    ![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-17-36-36-image.png)
    
    ![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-03-17-36-52-image.png)

## 用户登录统一鉴权（Token解析）

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-04-18-08-38-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-04-18-10-35-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-04-18-10-51-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-04-18-12-54-image.png)

# Common模块

- PareTokenUtil鉴权做token解析，并将用户信息放到ThreadLocal，保证线程安全，避免资源混乱



## Authority授权中心

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-16-00-44-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-16-03-34-image.png)



![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-16-05-43-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-16-10-26-image.png)

# 网关SpringCloud Gateway

- 通过全局过滤器实现登录、注册、鉴权

- 动态路由

- 动态限流 。结合 nacos和sentinal

- 

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-16-25-02-image.png)

<img title="" src="file:///C:/Users/Administrator/AppData/Roaming/marktext/images/2022-10-05-16-29-53-image.png" alt="" width="908">

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-16-44-45-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-16-56-50-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-17-39-32-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-17-38-59-image.png)

## sentinal限流

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-23-15-08-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-15-33-image.png)

## sentinal容错降级

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-23-42-25-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-23-43-07-image.png)

## sentinal支持openFeign的容错降级

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-23-45-15-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-23-49-08-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-05-23-52-59-image.png)

## 结合nacos，实现限流规则持久化

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-02-06-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-06-11-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-06-47-image.png)

## Gateway集成Sentinal实现限流

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-17-23-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-26-36-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-27-16-image.png)

## Gateway集成sentinal结合nacos 实现动态限流

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-33-20-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-34-21-image.png)

### 通过在nacos修改count值，下图单机阈值会同步

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-38-25-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-39-04-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-42-24-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-45-07-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-47-51-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-48-55-image.png)

![](C:\Users\Administrator\AppData\Roaming\marktext\images\2022-10-06-00-51-52-image.png)
